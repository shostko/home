virtual_state:

  input_select:

    home_presence:
      name: Home Presence
      options:
        - 'Away'
        - 'Noone'
        - 'Someone'
        - 'Everyone'
        - 'Undefined'
      icon: mdi:home-account

  automation:
    
    - alias: 'Home Presence update'
      id: 'Home Presence update'
      mode: queued
      trigger:
        # Запущен HA
        - platform: homeassistant
          event: start
        # Перезагружены автоматизации
        - platform: event
          event_type: automation_reloaded
        # Изменилось количество людей в зоне ДОМ
        - platform: state
          entity_id: zone.home
          for: '00:10:00'
        # Изменилось количество людей в зоне ДАЧА
        - platform: state
          entity_id: zone.dacha
          for: '00:05:00'
      action:
        - service: input_select.select_option
          target:
            entity_id: input_select.home_presence
          data:
            option: >
              {%- if is_state('zone.dacha', '2') -%}
                Away
              {%- elif is_state('zone.home', '2') -%}
                Everyone
              {%- elif is_state('zone.home', '1') -%}
                Someone
              {%- elif is_state('zone.home', '0') -%}
                Noone
              {%- else %}
                Undefined
              {%- endif -%}
    
    - alias: 'LOG: Home Presence updated'
      id: 'LOG: Home Presence updated'
      mode: queued
      trigger:
        - platform: state
          entity_id: input_select.home_presence
      action:
        # Отправить сообщение в log
        - service: notify.log
          data:
            message: "Home Presence updated: {{ states('input_select.home_presence') }}"
